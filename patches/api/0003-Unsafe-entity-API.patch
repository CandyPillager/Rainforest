From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Mariell Hoversholm <proximyst@proximyst.com>
Date: Fri, 17 Jul 2020 21:34:37 +0200
Subject: [PATCH] Unsafe entity API

---
 src/main/java/org/bukkit/entity/Entity.java | 55 +++++++++++++++++++++
 src/main/java/org/bukkit/entity/Player.java | 24 +++++++++
 2 files changed, 79 insertions(+)

diff --git a/src/main/java/org/bukkit/entity/Entity.java b/src/main/java/org/bukkit/entity/Entity.java
index 4d1970bec04c5a3cf01d214f583efb0e1d08380d..a700198db0dc188f62ac1bb57d729bf62782a1b0 100644
--- a/src/main/java/org/bukkit/entity/Entity.java
+++ b/src/main/java/org/bukkit/entity/Entity.java
@@ -696,4 +696,59 @@ public interface Entity extends Metadatable, CommandSender, Nameable, Persistent
      */
     public boolean isTicking();
     // Paper end
+
+    // Rainforest start
+    /**
+     * @return Unsafe API.
+     */
+    @NotNull
+    Unsafe getUnsafeApi();
+
+    /**
+     * Unsafe API for {@link Entity entities}.
+     */
+    interface Unsafe {
+        /**
+         * Rotate without teleporting.
+         *
+         * @param yaw New yaw.
+         * @param pitch New pitch.
+         */
+        void rotate(float yaw, float pitch);
+
+        /**
+         * This should only be needed on <i>some</i> living entities like the ender dragon.
+         *
+         * @param yaw New yaw, to be clamped.
+         * @param pitch New pitch, to be clamped.
+         */
+        default void clampedRotate(float yaw, float pitch) {
+            while (yaw < 180F) {
+                yaw += 360F;
+            }
+            while (yaw >= 180F) {
+                yaw -= 360F;
+            }
+
+            while (pitch < 180F) {
+                pitch += 360F;
+            }
+            while (pitch >= 180F) {
+                pitch -= 360F;
+            }
+
+            rotate(yaw, pitch);
+        }
+
+        /**
+         * @param invisibility New invisibility.
+         */
+        void setInvisible(boolean invisibility);
+
+        /**
+         * @param invulnerablity New invulnerability.
+         */
+        void setInvulnerable(boolean invulnerablity);
+    }
+    // Rainforest end
 }
diff --git a/src/main/java/org/bukkit/entity/Player.java b/src/main/java/org/bukkit/entity/Player.java
index 16bdb4b717368d121e84121f85bbf3de5fb642f1..1c9f356462229788fdb274c9b137620179c48a99 100644
--- a/src/main/java/org/bukkit/entity/Player.java
+++ b/src/main/java/org/bukkit/entity/Player.java
@@ -24,6 +24,7 @@ import org.bukkit.advancement.Advancement;
 import org.bukkit.advancement.AdvancementProgress;
 import org.bukkit.block.data.BlockData;
 import org.bukkit.conversations.Conversable;
+import org.bukkit.entity.Entity.Unsafe;
 import org.bukkit.event.player.PlayerResourcePackStatusEvent;
 import org.bukkit.inventory.ItemStack;
 import org.bukkit.map.MapView;
@@ -1900,4 +1901,27 @@ public interface Player extends HumanEntity, Conversable, OfflinePlayer, PluginM
     @Override
     Spigot spigot();
     // Spigot end
+
+    // Rainforest start
+    @NotNull
+    @Override
+    Unsafe getUnsafeApi();
+
+    /**
+     * Unsafe API for {@link Player players}.
+     */
+    interface Unsafe extends Entity.Unsafe {
+        /**
+         * Send an update of current passengers.
+         */
+        void updatePassengers();
+
+        /**
+         * Destroy an entity in the eyes of the client.
+         *
+         * @param entity The entity to destroy.
+         */
+        void destroyEntity(@NotNull Entity entity);
+    }
+    // Rainforest end
 }
